{"version":3,"file":"ClippingGroup.js","sources":["../../../src/ClippingGroup.ts"],"sourcesContent":["import {\n  FabricObject,\n  FixedLayout,\n  Group,\n  GroupProps,\n  LayoutManager,\n  Path,\n  classRegistry,\n} from 'fabric';\n\nexport class ClippingGroup extends Group {\n  static type = 'clipping';\n\n  private blockErasing = false;\n\n  constructor(objects: FabricObject[], options: Partial<GroupProps>) {\n    super(objects, {\n      originX: 'center',\n      originY: 'center',\n      left: 0,\n      top: 0,\n      layoutManager: new LayoutManager(new FixedLayout()),\n      ...options,\n    });\n  }\n\n  drawObject(ctx: CanvasRenderingContext2D) {\n    const paths: Path[] = [];\n    const objects: FabricObject[] = [];\n    this._objects.forEach((object) =>\n      (object instanceof Path ? paths : objects).push(object)\n    );\n\n    ctx.save();\n    ctx.fillStyle = 'black';\n    ctx.fillRect(-this.width / 2, -this.height / 2, this.width, this.height);\n    ctx.restore();\n\n    !this.blockErasing &&\n      paths.forEach((path) => {\n        path.render(ctx);\n      });\n\n    objects.forEach((object) => {\n      object.globalCompositeOperation = object.inverted\n        ? 'destination-out'\n        : 'source-in';\n      object.render(ctx);\n    });\n  }\n}\n\nclassRegistry.setClass(ClippingGroup);\n"],"names":["ClippingGroup","_Group","_inherits","objects","options","_this","_classCallCheck","_callSuper","_objectSpread","originX","originY","left","top","layoutManager","LayoutManager","FixedLayout","_defineProperty","_assertThisInitialized","_createClass","key","value","drawObject","ctx","paths","_objects","forEach","object","Path","push","save","fillStyle","fillRect","width","height","restore","blockErasing","path","render","globalCompositeOperation","inverted","Group","classRegistry","setClass"],"mappings":";;;AAUaA,IAAAA,aAAa,0BAAAC,MAAA,EAAA;EAAAC,SAAA,CAAAF,aAAA,EAAAC,MAAA,CAAA,CAAA;AAKxB,EAAA,SAAAD,aAAYG,CAAAA,OAAuB,EAAEC,OAA4B,EAAE;AAAA,IAAA,IAAAC,KAAA,CAAA;AAAAC,IAAAA,eAAA,OAAAN,aAAA,CAAA,CAAA;AACjEK,IAAAA,KAAA,GAAAE,UAAA,CAAA,IAAA,EAAAP,aAAA,EAAMG,CAAAA,OAAO,EAAAK,cAAA,CAAA;AACXC,MAAAA,OAAO,EAAE,QAAQ;AACjBC,MAAAA,OAAO,EAAE,QAAQ;AACjBC,MAAAA,IAAI,EAAE,CAAC;AACPC,MAAAA,GAAG,EAAE,CAAC;AACNC,MAAAA,aAAa,EAAE,IAAIC,aAAa,CAAC,IAAIC,WAAW,EAAE,CAAA;AAAC,KAAA,EAChDX,OAAO,CAAA,CAAA,CAAA,CAAA;AACTY,IAAAA,eAAA,CAAAC,sBAAA,CAAAZ,KAAA,mBAVkB,KAAK,CAAA,CAAA;AAAA,IAAA,OAAAA,KAAA,CAAA;AAW5B,GAAA;AAACa,EAAAA,YAAA,CAAAlB,aAAA,EAAA,CAAA;IAAAmB,GAAA,EAAA,YAAA;AAAAC,IAAAA,KAAA,EAED,SAAAC,UAAWC,CAAAA,GAA6B,EAAE;MACxC,IAAMC,KAAa,GAAG,EAAE,CAAA;MACxB,IAAMpB,OAAuB,GAAG,EAAE,CAAA;AAClC,MAAA,IAAI,CAACqB,QAAQ,CAACC,OAAO,CAAC,UAACC,MAAM,EAAA;AAAA,QAAA,OAC3B,CAACA,MAAM,YAAYC,IAAI,GAAGJ,KAAK,GAAGpB,OAAO,EAAEyB,IAAI,CAACF,MAAM,CAAC,CAAA;AAAA,OACzD,CAAC,CAAA;MAEDJ,GAAG,CAACO,IAAI,EAAE,CAAA;MACVP,GAAG,CAACQ,SAAS,GAAG,OAAO,CAAA;MACvBR,GAAG,CAACS,QAAQ,CAAC,CAAC,IAAI,CAACC,KAAK,GAAG,CAAC,EAAE,CAAC,IAAI,CAACC,MAAM,GAAG,CAAC,EAAE,IAAI,CAACD,KAAK,EAAE,IAAI,CAACC,MAAM,CAAC,CAAA;MACxEX,GAAG,CAACY,OAAO,EAAE,CAAA;MAEb,CAAC,IAAI,CAACC,YAAY,IAChBZ,KAAK,CAACE,OAAO,CAAC,UAACW,IAAI,EAAK;AACtBA,QAAAA,IAAI,CAACC,MAAM,CAACf,GAAG,CAAC,CAAA;AAClB,OAAC,CAAC,CAAA;AAEJnB,MAAAA,OAAO,CAACsB,OAAO,CAAC,UAACC,MAAM,EAAK;QAC1BA,MAAM,CAACY,wBAAwB,GAAGZ,MAAM,CAACa,QAAQ,GAC7C,iBAAiB,GACjB,WAAW,CAAA;AACfb,QAAAA,MAAM,CAACW,MAAM,CAACf,GAAG,CAAC,CAAA;AACpB,OAAC,CAAC,CAAA;AACJ,KAAA;AAAC,GAAA,CAAA,CAAA,CAAA;AAAA,EAAA,OAAAtB,aAAA,CAAA;AAAA,CAAA,CAvCgCwC,KAAK,EAAA;AAwCvCxB,eAAA,CAxCYhB,aAAa,EAAA,MAAA,EACV,UAAU,CAAA,CAAA;AAyC1ByC,aAAa,CAACC,QAAQ,CAAC1C,aAAa,CAAC;;;;"}